<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Code Review</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* basic style */
    body {
      font-family: Helvetica;
    }

    h1 {
      font-size: 24px;
    }

    h2 {
      font-size: 20px;
      color: green;
    }

    h3 {
      font-size: 16px;
      padding-left: 5px;
      margin-bottom: 5px;
    }

    p {
      white-space: pre-wrap;
      margin: 0;
    }

    pre {
      margin: 0
    }

    code {
      border: 1px solid #999;
      display: block;
      white-space: pre-wrap;
    }

    /* links in headlines */
    h3.lines-headline>a {
      color: #005bbb;
      text-decoration: none;
    }

    h3.lines-headline>a:hover {
      text-decoration: underline;
    }

    /* table style */
    table.review-table {
      font-size: 14px;
      padding-left: 10px;
    }

    table.review-table .caption {
      font-weight: bold;
      vertical-align: top;
    }

    table.review-table tr>td:first-child {
      width: 120px
    }

    /* priority indicator */
    .text>span:before {
      content: "";
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
      margin-left: -15px;
    }

    .text>span.prio-high:before {
      background: #FF4500;
    }

    .text>span.prio-medium:before {
      background: #FFD700;
    }

    .text>span.prio-low:before {
      background: #9ACD32;
    }

    .text>span.prio-none:before {
      background: #D3D3D3;
    }
  </style>
</head>

<body>
  <h1 class="main-headline">Code Review Results</h1>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\views\layouts\main.hbs</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>OK, but functinonality must work with client-side JS diasabled.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-0-0">&lt;script src&#x3D;&quot;https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js&quot;&gt;&lt;/script&gt;</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\views\add-joke.hbs</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>OK!</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-1-0">&lt;script&gt;
    {{#if errors.length}}
    const notyf &#x3D; new Notyf({
        types: [
            {
                type: &#x27;error&#x27;,
                icon: false
            }
        ],
        duration: 60000,
        dismissible: true,
        icon: false,
        position: {
            x: &#x27;right&#x27;,
            y: &#x27;bottom&#x27;,
        }
    })
    {{#each errors}}
    notyf.error(&#x27;{{this}}&#x27;)
    {{/each}}
            {{/if}}
&lt;/script&gt;


&lt;noscript&gt;
    {{#if errors.length}}
    &lt;p&gt;Can not add the joke because:&lt;/p&gt;
    &lt;ul&gt;
        {{#each errors}}
        &lt;li&gt;{{this}}&lt;/li&gt;
        {{/each}}
    &lt;/ul&gt;
    {{/if}}
&lt;/noscript&gt;</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Doesn&#x27;t exist.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-1-1">&lt;h7&gt;ACCESS PROHIBITED&lt;/h7&gt;</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\views\add-software.hbs</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Consider using partial isntead of copy-pasting this code on many pages.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-2-0">&lt;script&gt;
    {{#if errors.length}}
    const notyf &#x3D; new Notyf({
        types: [
            {
                type: &#x27;error&#x27;,
                icon: false
            }
        ],
        duration: 60000,
        dismissible: true,
        icon: false,
        position: {
            x: &#x27;right&#x27;,
            y: &#x27;bottom&#x27;,
        }
    })
    {{#each errors}}
    notyf.error(&quot;{{this}}&quot;)
    {{/each}}
            {{/if}}
&lt;/script&gt;</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\views\create-faq.hbs</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Indentation wrong, and you have copy-pasted this, so the error is at many places.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-3-0">    {{/each}}
            {{/if}}
&lt;/script&gt;</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\views\edit-faq.hbs</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Strange. Use CSS to make the link look like a button instead.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-4-0">&lt;button&gt;&lt;a href&#x3D;&#x27;/faq&#x27;&gt;Cancel&lt;/a&gt;&lt;/button&gt;
&lt;input type&#x3D;&#x27;submit&#x27; value&#x3D;&#x27;Update&#x27;&gt;</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\database.js</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Mixed indentation conventions. Code also copy-pasted, so the error exists at three places.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-5-0">		description TEXT,
        link TEXT
	)
&#x60;)</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Given the name of the function, I would expect to only get back a number. You isntead send back an object?</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-5-1">exports.countJokes &#x3D; function(callback) {
	db.get( &#x27;SELECT COUNT(*) as numberOfJokes from jokelist&#x27;, callback )
}</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Long code lines are hard to read. Try to keep each line below 80 characters wide.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-5-2">	db.all( &#x27;SELECT * FROM jokelist ORDER BY id desc limit ? offset ?&#x27;, [ jokesPerPage, offsetJokes ], callback )
}</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\app.js</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Remove code you don&#x27;t use.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-6-0">const sqlite &#x3D; require(&#x27;sqlite3&#x27;)</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\routers\auth-router.js</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Prefer const over var.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-7-0">var csrfProtection &#x3D; csrf();</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Reove code oyu don&#x27;t use.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-7-1">const SALT_ROUNDS &#x3D; 10;</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Loggins out should not be a GET request.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-7-2">router.get( &#x27;/logout&#x27;, function( request, response )
{
	if( request.session.isLoggedIn ){
		request.session.destroy(function(error){
			errors.printError(error)
			response.redirect(&#x27;/&#x27;)			
		})
	}else{
		response.redirect(&#x27;/&#x27;)
	}
})</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Why tabs at the end of the line?</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-7-3">	response.redirect(&#x27;/&#x27;)			
})</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Be consistent with how you use semicolon.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-7-4">	response.render( &quot;login.hbs&quot;, { username: username, password: password, errors: errors, csrfToken: request.csrfToken() })
	return
}
const validPassword &#x3D; bcrypt.compare( password, ADMIN_PASSWORD_HASH );</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>This makes no sense. &quot;validPassword&quot; sounds like &quot;the correct password&quot;, e.g. abc123. Use better name.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-7-5">if( username &#x3D;&#x3D; ADMIN_USERNAME &amp;&amp; validPassword )
{</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\routers\faq-router.js</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Reading this part of the code makes no sense. Looks like you always expect to receive an error.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-8-0">db.getFaqList( function( error, list )
{
	errors.printError( &quot;SQL error, can&#x27;t retrieve faqlist:&quot;, error )</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Prefer const.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-8-1">var errorList &#x3D; validators.faqValidation( question, answer )

var faqRecord &#x3D; { question: question, answer: answer }
</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>id should not be in the body; the URI should identify the resource.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-8-2">router.post( &#x27;/delete/&#x27;, function( request, response )
{
	const id &#x3D; request.body.id</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\validators.js</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Use more specific name. When adding new resources that might have descirption in the future, you might want to give them other range, and then you will get into problem with your naming convention.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-9-0">const RANGE_DESCRIPTION_LENGTH &#x3D; [5, 200]
const RANGE_LINK_LENGTH &#x3D; [8, 80]</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Use better name. Unclear what the function does (return errors? Display errors? throw errors? Etc.). 

Funciton name should also be verb.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-9-1">exports.authValidation &#x3D; function (username, password) {
</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\routers\joke-router.js</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Be conisstent with const and semicolons.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-10-0">const validators &#x3D; require(&#x27;../validators&#x27;)

var csrf &#x3D; require(&#x27;csurf&#x27;);
var csrfProtection &#x3D; csrf();
router.use(csrfProtection);</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>This line of code iss really hard to read. Don&#x27;t try to write eveyrthing on one and the same line.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-10-1">response.render( &#x27;joke.hbs&#x27;, { jokelist: list, curPage: page, Previous: page &gt; 1 ? page - 1 : undefined, Next: page &lt; maxPages ? page + 1 : undefined })</code></pre>
        </td>
      </tr>
    </table>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>Security vulenrability, no authorization.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-10-2">router.post( &#x27;/add&#x27;, function( request, response )
{
	const title &#x3D; request.body.title
	const text &#x3D; request.body.text
	var errorList &#x3D; validators.jokeValidation(title, text)
	var jokeRecord &#x3D; { title: title, text: text }
	if( errorList.length &#x3D;&#x3D; 0 )
	{
		db.addJoke( title, text, function(error)
		{
			errors.printError( &quot;SQL error, can&#x27;t add the joke:&quot;, error )
			if(error)
			{
				response.render( &#x27;add-joke.hbs&#x27;, { joke: jokeRecord, csrfToken: request.csrfToken(), errors: [&quot;Internal Server Error&quot;] })
			}else{
				response.redirect(&#x27;/joke&#x27;)
			}
		})
	}else{
		response.render(&#x27;add-joke.hbs&#x27;, { joke: jokeRecord, csrfToken: request.csrfToken(), errors: errorList })
	}
})</code></pre>
        </td>
      </tr>
    </table>
  </section>
  <section class="file-section">
    <h2 class="file-section-headline">\SitsenaLounge\routers\software-router.js</h2>
    <table class="review-table" style="margin-bottom: 1.5em;">
      <tr class="row-description">
        <td class="caption">Description</td>
        <td class="text">
          <p>No authorization checks, security vulenrability.</p>
        </td>
      </tr>
      <tr class="row-code">
        <td class="caption">Code</td>
        <td class="text">
          <pre><code id="code-block-11-0">router.post( &#x27;/add&#x27;, function( request, response )
{
	const name &#x3D; request.body.name
	const description &#x3D; request.body.description
	const link &#x3D; request.body.link

	var errorList &#x3D; validators.softwareValidation(name, description, link)
	var softwareRecord &#x3D; { name: name, description: description, link: link }
	if( errorList.length &#x3D;&#x3D; 0 )
	{
		db.addSoftware( name, description, link, function (error)
		{
			errors.printError( &quot;SQL error, can&#x27;t add the software:&quot;, error )
			if(error)
			{
				response.render( &#x27;add-software.hbs&#x27;, { software: softwareRecord, csrfToken: request.csrfToken(), errors: [&quot;Internal Server Error&quot;] })
			}else{
				response.redirect(&#x27;/software&#x27;)
			}
		})
	}else{
		response.render( &#x27;add-software.hbs&#x27;, { software: softwareRecord, csrfToken: request.csrfToken(), errors: errorList })
	}

})</code></pre>
        </td>
      </tr>
    </table>
  </section>
</body>

</html>
